!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoDiff=e():t.AutoDiff=e()}(self,(function(){return(()=>{"use strict";var t={888:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithArithmetic=e.Pow=e.Div=e.Mult=e.Sum=e.Neg=void 0;const s=i(433);class n extends s.Op{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.Neg=n;class r extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.Sum=r;class h extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.Mult=h;class d extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("/")}derivative(t){const[e,i]=this.dependsOn;return`(${e.derivRef(t)}*${i.ref()}-${i.derivRef(t)}*${e.ref()})/(${i.ref()}*${i.ref()})`}}e.Div=d;class a extends s.Op{definition(){return`pow(${this.dependsOn[0].ref()},${this.dependsOn[1].ref()})`}derivative(t){const[e,i]=this.dependsOn;return i.isConst()?`${i.ref()}*pow(${e.ref()},${i.ref()}-1.0)`:e.isConst()?`pow(${e.ref()},${i.ref()})*log(${e.ref()})*${i.derivRef(t)}`:`pow(${e.ref()},${i.ref()})*(${i.ref()}*(1.0/${e.ref()}*${e.derivRef(t)})+log(${e.ref()})*${i.derivRef(t)})`}}e.Pow=a,s.Op.prototype.neg=s.UserInput((function(){return new n(this.ad,this)})),s.Op.prototype.add=s.UserInput((function(...t){if(0===t.length)throw new Error(`add() called with too few arguments: ${t}`);return new r(this.ad,this,...this.ad.convertVals(t))})),s.Op.prototype.sub=s.UserInput((function(t){return this.add(this.ad.convertVal(t).neg())})),s.Op.prototype.mult=s.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new h(this.ad,this,this.ad.convertVal(t[0])):this.mult(t[0]).mult(...t.slice(1))})),s.Op.prototype.div=s.UserInput((function(t){return new d(this.ad,this,this.ad.convertVal(t))})),s.Op.prototype.pow=s.UserInput((function(t){return new a(this.ad,this,this.ad.convertVal(t))})),s.Op.prototype.sqrt=s.UserInput((function(){return this.pow(.5)})),e.WithArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.sum=s.UserInput((function(...t){if(0===t.length)throw new Error(`sum() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.add(...t.slice(1)):e}})),this.prod=s.UserInput((function(...t){if(0===t.length)throw new Error(`prod() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.mult(...t.slice(1)):e}})),this.sqrt=s.UserInput((function(t){return this.convertVal(t).sqrt()}))}}}},433:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Param=e.Value=e.OpLiteral=e.Op=e.UserInput=e.getStack=void 0,e.getStack=()=>{var t,e;const i=new Error;if(!i.stack)try{throw i}catch(i){if(!i.stack)return[]}const s=/:(\d+):(?:\d+)[^\d]*$/;return null!==(e=null===(t=i.stack)||void 0===t?void 0:t.toString().split(/\r\n|\n/).filter((t=>t.match(s))))&&void 0!==e?e:[]},e.UserInput=function(t){return function(...i){var s;const n=t.apply(this,i);if(n.ad.settings.debug){const t=e.getStack();n.srcLine=null!==(s=t[2])&&void 0!==s?s:""}return n}};class i{constructor(t,...e){this.usedIn=[],this.srcLine="",this.ad=t,this.id=t.getNextID(),this.dependsOn=e;for(const t of e)t.usedIn.push(this)}scalar(){return!0}size(){return 1}glslType(){return this.scalar()?"float":`vec${this.size()}`}depth(){if(this.usedIn.length>1)return 1;const t=Math.max(0,...this.dependsOn.map((t=>t.depth())))+1;return t>this.ad.settings.maxDepthPerVariable?1:t}useTempVar(){return 1===this.depth()}ref(){return this.useTempVar()?`_glslad_v${this.id}`:`(${this.definition()})`}derivRef(t){return this.useTempVar()?`_glslad_dv${this.id}_d${t.name}`:`(${this.derivative(t)})`}initializer(){if(this.useTempVar()){let t=`${this.glslType()} ${this.ref()}=${this.definition()};`;return this.ad.settings.debug&&this.srcLine&&(t=`\n// From ${this.srcLine}\n`+t),t+="\n",t}return""}derivInitializer(t){return this.useTempVar()?`${this.glslType()} ${this.derivRef(t)}=${this.derivative(t)};\n`:""}isConst(){return this.dependsOn.every((t=>t.isConst()))}deepDependencies(){const t=new Set;for(const e of this.dependsOn){for(const i of e.deepDependencies().values())t.add(i);t.add(e)}return t}output(t){return this.ad.output(t,this)}outputDeriv(t,e){return this.ad.outputDeriv(t,e,this)}}e.Op=i;class s extends i{initializer(){return""}derivInitializer(){return""}ref(){return this.definition()}derivRef(t){return this.derivative(t)}}e.OpLiteral=s,e.Value=class extends s{constructor(t,e){super(t),this.val=e}isConst(){return!0}definition(){const t=`${this.val.toFixed(4)}`;return this.val<0?`(${t})`:t}derivative(){return"0.0"}},e.Param=class extends s{constructor(t,e){super(t),this.name=e,this.ad.registerParam(this,e)}isConst(){return!1}definition(){return this.name}derivative(t){return t===this?"1.0":"0.0"}}},225:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithFunctions=e.IfElse=e.Max=e.Min=e.Clamp=e.Mix=e.Cos=e.Sin=void 0;const s=i(433);class n extends s.Op{definition(){return`sin(${this.dependsOn[0].ref()})`}derivative(t){return`cos(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Sin=n;class r extends s.Op{definition(){return`cos(${this.dependsOn[0].ref()})`}derivative(t){return`-sin(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Cos=r;class h extends s.Op{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`(1.0-${e.ref()})*${s.derivRef(t)}+(-${e.derivRef(t)})*${s.ref()}+${i.ref()}*${s.derivRef(t)}+${i.derivRef(t)}*${s.ref()}`}}e.Mix=h;class d extends s.Op{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}<${i.ref()} ? 0.0 : (${e.ref()}>${s.ref()} ? 0.0 : ${e.derivRef(t)})`}}e.Clamp=d;class a extends s.Op{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}<${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Min=a;class u extends s.Op{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}>${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Max=u;class o extends s.Op{definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${s.derivRef(t)}`}}e.IfElse=o,s.Op.prototype.sin=s.UserInput((function(){return new n(this.ad,this)})),s.Op.prototype.cos=s.UserInput((function(){return new r(this.ad,this)})),s.Op.prototype.tan=s.UserInput((function(){return this.sin().div(this.cos())})),s.Op.prototype.mix=s.UserInput((function(t,e){return new h(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),s.Op.prototype.clamp=s.UserInput((function(t,e){return new d(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),s.Op.prototype.min=s.UserInput((function(...t){return t.reduce(((t,e)=>new a(this.ad,t,this.ad.convertVal(e))),this)})),s.Op.prototype.max=s.UserInput((function(...t){return t.reduce(((t,e)=>new u(this.ad,t,this.ad.convertVal(e))),this)})),s.Op.prototype.ifElse=s.UserInput((function(t,e){return new o(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),e.WithFunctions=function(t){return class extends t{constructor(){super(...arguments),this.sin=s.UserInput((function(t){return this.convertVal(t).sin()})),this.cos=s.UserInput((function(t){return this.convertVal(t).cos()})),this.tan=s.UserInput((function(t){return this.convertVal(t).tan()})),this.mix=s.UserInput((function(t,e,i){return this.convertVal(t).mix(e,i)})),this.clamp=s.UserInput((function(t,e,i){return this.convertVal(t).clamp(e,i)})),this.min=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.min(...t.slice(1)):e}})),this.max=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.max(...t.slice(1)):e}})),this.ifElse=s.UserInput((function(t,e,i){return this.convertVal(t).ifElse(e,i)}))}}}},165:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecArithmetic=e.VecMult=e.VecScale=e.VecSum=e.VecNeg=void 0;const s=i(433),n=i(789);class r extends n.WithVecDependencies{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.VecNeg=r;class h extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.VecSum=h;class d extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecScale=d;class a extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecMult=a,n.VectorOp.prototype.neg=s.UserInput((function(){return new r(this.ad,this)})),n.VectorOp.prototype.add=s.UserInput((function(...t){return new h(this.ad,this,...t)})),n.VectorOp.prototype.scale=s.UserInput((function(t){return new d(this.ad,this,this.ad.convertVal(t))})),n.VectorOp.prototype.mult=s.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new a(this.ad,this,t[0]):this.mult(t[0]).mult(...t.slice(1))})),e.WithVecArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.vecSum=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecSum()!");return 1===t.length?t[0]:t[0].add(...t.slice(1))})),this.vecProd=s.UserInput((function(...t){return t.reduce(((t,e)=>t.mult(e)))}))}}}},789:function(t,e,i){var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,h=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,i,s);else for(var d=t.length-1;d>=0;d--)(n=t[d])&&(h=(r<3?n(h):r>3?n(e,i,h):n(e,i))||h);return r>3&&h&&Object.defineProperty(e,i,h),h},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecBase=e.VecParam=e.Vec=e.ScalarWithVecDependencies=e.WithVecDependencies=e.VectorOp=e.Cache=e.VecParamElementRef=e.VecElementRef=void 0;const r=i(433);class h extends r.Op{constructor(t,e,i){super(t,i),this.prop=e}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return`${this.dependsOn[0].derivRef(t)}.${this.prop}`}}e.VecElementRef=h;class d extends r.OpLiteral{constructor(t,e,i){super(t,i),this.prop=e,this.name=`_glslad_r${i.id}_${e}`,this.ad.registerParam(this,this.name)}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return t===this?"1.0":"0.0"}}function a(t,e,i){const s=i.value,n=new Map;return i.value=function(...t){let e=n.get(this);return e||(e=s.apply(this,...t),n.set(this,e)),e},i}e.VecParamElementRef=d,e.Cache=a;class u extends r.Op{scalar(){return!1}x(){return new h(this.ad,"x",this)}y(){return new h(this.ad,"y",this)}z(){return new h(this.ad,"z",this)}w(){return new h(this.ad,"w",this)}getVecElementRef(t){if("x"===t)return this.x();if("y"===t)return this.y();if("z"===t)return this.z();if("w"===t)return this.w();throw new Error(`Can't get element ref ${t}`)}u(){return this.x()}v(){return this.y()}r(){return this.x()}g(){return this.y()}b(){return this.z()}a(){return this.w()}xyzw(){return new p(this.ad,this.x(),this.y(),this.z(),this.w())}xywz(){return new p(this.ad,this.x(),this.y(),this.w(),this.z())}xzyw(){return new p(this.ad,this.x(),this.z(),this.y(),this.w())}xzwy(){return new p(this.ad,this.x(),this.z(),this.w(),this.y())}xwyz(){return new p(this.ad,this.x(),this.w(),this.y(),this.z())}xwzy(){return new p(this.ad,this.x(),this.w(),this.z(),this.y())}yxzw(){return new p(this.ad,this.y(),this.x(),this.z(),this.w())}yxwz(){return new p(this.ad,this.y(),this.x(),this.w(),this.z())}yzxw(){return new p(this.ad,this.y(),this.z(),this.x(),this.w())}yzwx(){return new p(this.ad,this.y(),this.z(),this.w(),this.x())}ywxz(){return new p(this.ad,this.y(),this.w(),this.x(),this.z())}ywzx(){return new p(this.ad,this.y(),this.w(),this.z(),this.x())}zxyw(){return new p(this.ad,this.z(),this.x(),this.y(),this.w())}zxwy(){return new p(this.ad,this.z(),this.x(),this.w(),this.y())}zyxw(){return new p(this.ad,this.z(),this.y(),this.x(),this.w())}zywx(){return new p(this.ad,this.z(),this.y(),this.w(),this.x())}zwxy(){return new p(this.ad,this.z(),this.w(),this.x(),this.y())}zwyx(){return new p(this.ad,this.z(),this.w(),this.y(),this.x())}wxyz(){return new p(this.ad,this.w(),this.x(),this.y(),this.z())}wxzy(){return new p(this.ad,this.w(),this.x(),this.z(),this.y())}wyxz(){return new p(this.ad,this.w(),this.y(),this.x(),this.z())}wyzx(){return new p(this.ad,this.w(),this.y(),this.z(),this.x())}wzxy(){return new p(this.ad,this.w(),this.z(),this.x(),this.y())}wzyx(){return new p(this.ad,this.w(),this.z(),this.y(),this.x())}xyz(){return new p(this.ad,this.x(),this.y(),this.z())}xzy(){return new p(this.ad,this.x(),this.z(),this.y())}yxz(){return new p(this.ad,this.y(),this.x(),this.z())}yzx(){return new p(this.ad,this.y(),this.z(),this.x())}zxy(){return new p(this.ad,this.z(),this.x(),this.y())}zyx(){return new p(this.ad,this.z(),this.y(),this.x())}xyw(){return new p(this.ad,this.x(),this.y(),this.w())}xwy(){return new p(this.ad,this.x(),this.w(),this.y())}yxw(){return new p(this.ad,this.y(),this.x(),this.w())}ywx(){return new p(this.ad,this.y(),this.w(),this.x())}wxy(){return new p(this.ad,this.w(),this.x(),this.y())}wyx(){return new p(this.ad,this.w(),this.y(),this.x())}xy(){return new p(this.ad,this.x(),this.y())}yx(){return new p(this.ad,this.y(),this.x())}xzw(){return new p(this.ad,this.x(),this.z(),this.w())}xwz(){return new p(this.ad,this.x(),this.w(),this.z())}zxw(){return new p(this.ad,this.z(),this.x(),this.w())}zwx(){return new p(this.ad,this.z(),this.w(),this.x())}wxz(){return new p(this.ad,this.w(),this.x(),this.z())}wzx(){return new p(this.ad,this.w(),this.z(),this.x())}xz(){return new p(this.ad,this.x(),this.z())}zx(){return new p(this.ad,this.z(),this.x())}xw(){return new p(this.ad,this.x(),this.w())}wx(){return new p(this.ad,this.w(),this.x())}yzw(){return new p(this.ad,this.y(),this.z(),this.w())}ywz(){return new p(this.ad,this.y(),this.w(),this.z())}zyw(){return new p(this.ad,this.z(),this.y(),this.w())}zwy(){return new p(this.ad,this.z(),this.w(),this.y())}wyz(){return new p(this.ad,this.w(),this.y(),this.z())}wzy(){return new p(this.ad,this.w(),this.z(),this.y())}yz(){return new p(this.ad,this.y(),this.z())}zy(){return new p(this.ad,this.z(),this.y())}yw(){return new p(this.ad,this.y(),this.w())}wy(){return new p(this.ad,this.w(),this.y())}zw(){return new p(this.ad,this.z(),this.w())}wz(){return new p(this.ad,this.w(),this.z())}rgba(){return new p(this.ad,this.r(),this.g(),this.b(),this.a())}rgab(){return new p(this.ad,this.r(),this.g(),this.a(),this.b())}rbga(){return new p(this.ad,this.r(),this.b(),this.g(),this.a())}rbag(){return new p(this.ad,this.r(),this.b(),this.a(),this.g())}ragb(){return new p(this.ad,this.r(),this.a(),this.g(),this.b())}rabg(){return new p(this.ad,this.r(),this.a(),this.b(),this.g())}grba(){return new p(this.ad,this.g(),this.r(),this.b(),this.a())}grab(){return new p(this.ad,this.g(),this.r(),this.a(),this.b())}gbra(){return new p(this.ad,this.g(),this.b(),this.r(),this.a())}gbar(){return new p(this.ad,this.g(),this.b(),this.a(),this.r())}garb(){return new p(this.ad,this.g(),this.a(),this.r(),this.b())}gabr(){return new p(this.ad,this.g(),this.a(),this.b(),this.r())}brga(){return new p(this.ad,this.b(),this.r(),this.g(),this.a())}brag(){return new p(this.ad,this.b(),this.r(),this.a(),this.g())}bgra(){return new p(this.ad,this.b(),this.g(),this.r(),this.a())}bgar(){return new p(this.ad,this.b(),this.g(),this.a(),this.r())}barg(){return new p(this.ad,this.b(),this.a(),this.r(),this.g())}bagr(){return new p(this.ad,this.b(),this.a(),this.g(),this.r())}argb(){return new p(this.ad,this.a(),this.r(),this.g(),this.b())}arbg(){return new p(this.ad,this.a(),this.r(),this.b(),this.g())}agrb(){return new p(this.ad,this.a(),this.g(),this.r(),this.b())}agbr(){return new p(this.ad,this.a(),this.g(),this.b(),this.r())}abrg(){return new p(this.ad,this.a(),this.b(),this.r(),this.g())}abgr(){return new p(this.ad,this.a(),this.b(),this.g(),this.r())}rgb(){return new p(this.ad,this.r(),this.g(),this.b())}rbg(){return new p(this.ad,this.r(),this.b(),this.g())}grb(){return new p(this.ad,this.g(),this.r(),this.b())}gbr(){return new p(this.ad,this.g(),this.b(),this.r())}brg(){return new p(this.ad,this.b(),this.r(),this.g())}bgr(){return new p(this.ad,this.b(),this.g(),this.r())}rga(){return new p(this.ad,this.r(),this.g(),this.a())}rag(){return new p(this.ad,this.r(),this.a(),this.g())}gra(){return new p(this.ad,this.g(),this.r(),this.a())}gar(){return new p(this.ad,this.g(),this.a(),this.r())}arg(){return new p(this.ad,this.a(),this.r(),this.g())}agr(){return new p(this.ad,this.a(),this.g(),this.r())}rg(){return new p(this.ad,this.r(),this.g())}gr(){return new p(this.ad,this.g(),this.r())}rba(){return new p(this.ad,this.r(),this.b(),this.a())}rab(){return new p(this.ad,this.r(),this.a(),this.b())}bra(){return new p(this.ad,this.b(),this.r(),this.a())}bar(){return new p(this.ad,this.b(),this.a(),this.r())}arb(){return new p(this.ad,this.a(),this.r(),this.b())}abr(){return new p(this.ad,this.a(),this.b(),this.r())}rb(){return new p(this.ad,this.r(),this.b())}br(){return new p(this.ad,this.b(),this.r())}ra(){return new p(this.ad,this.r(),this.a())}ar(){return new p(this.ad,this.a(),this.r())}gba(){return new p(this.ad,this.g(),this.b(),this.a())}gab(){return new p(this.ad,this.g(),this.a(),this.b())}bga(){return new p(this.ad,this.b(),this.g(),this.a())}bag(){return new p(this.ad,this.b(),this.a(),this.g())}agb(){return new p(this.ad,this.a(),this.g(),this.b())}abg(){return new p(this.ad,this.a(),this.b(),this.g())}gb(){return new p(this.ad,this.g(),this.b())}bg(){return new p(this.ad,this.b(),this.g())}ga(){return new p(this.ad,this.g(),this.a())}ag(){return new p(this.ad,this.a(),this.g())}ba(){return new p(this.ad,this.b(),this.a())}ab(){return new p(this.ad,this.a(),this.b())}uv(){return new p(this.ad,this.u(),this.v())}vu(){return new p(this.ad,this.v(),this.u())}}s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"x",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"y",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"z",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"w",null),e.VectorOp=u,e.WithVecDependencies=class extends u{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}};class o extends r.Op{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}}e.ScalarWithVecDependencies=o;class p extends u{size(){return this.dependsOn.length}definition(){return`vec${this.size()}(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`vec${this.size()}(${this.dependsOn.map((e=>e.derivRef(t))).join(",")})`}x(){return this.dependsOn[0]}y(){return this.dependsOn[1]}z(){return this.dependsOn[2]}w(){return this.dependsOn[3]}}e.Vec=p;class c extends u{constructor(t,e,i){super(t),this.name=e,this._size=i}size(){return this._size}x(){return new d(this.ad,"x",this)}y(){return new d(this.ad,"y",this)}z(){return new d(this.ad,"z",this)}w(){return new d(this.ad,"w",this)}getElems(){return"xyzw".split("").slice(0,this.size()).map((t=>this.getVecElementRef(t)))}definition(){return this.name}derivative(t){return`vec${this.size()}(${this.getElems().map((e=>e.derivRef(t))).join(",")})`}initializer(){return""}ref(){return this.definition()}derivInitializer(t){return this.useTempVar()?`vec${this.size()} ${this.derivRef(t)}=${this.derivative(t)};\n`:""}}s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],c.prototype,"x",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],c.prototype,"y",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],c.prototype,"z",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],c.prototype,"w",null),e.VecParam=c,e.WithVecBase=function(t){return class extends t{constructor(){super(...arguments),this.vec2Param=r.UserInput((function(t){return new c(this,t,2)})),this.vec3Param=r.UserInput((function(t){return new c(this,t,3)})),this.vec4Param=r.UserInput((function(t){return new c(this,t,4)})),this.vec2=r.UserInput((function(t,e){return new p(this,this.convertVal(t),this.convertVal(e))})),this.vec3=r.UserInput((function(t,e,i){return new p(this,...this.convertVals([t,e,i]))})),this.vec4=r.UserInput((function(t,e,i,s){return new p(this,...this.convertVals([t,e,i,s]))}))}}}},35:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecFunctions=e.Dist=e.Length=e.Dot=e.VecIfElse=e.VecMax=e.VecMin=e.VecClamp=e.VecMix=void 0;const s=i(433),n=i(789);class r extends n.WithVecDependencies{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`(1.0-${e.ref()})*${s.derivRef(t)}+(-${e.derivRef(t)})*${s.ref()}+${i.ref()}*${s.derivRef(t)}+${i.derivRef(t)}*${s.ref()}`}}e.VecMix=r;class h extends n.WithVecDependencies{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),n=Array(this.size()).fill(0).map(((n,r)=>{return h=e[r],d=i[r],a=s[r],`${h.ref()}<${d.ref()} ? 0.0 : (${h.ref()}>${a.ref()} ? 0.0 : ${h.derivRef(t)})`;var h,d,a})).join(",");return`vec${this.size()}(${n})`}}e.VecClamp=h;class d extends n.WithVecDependencies{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),s=Array(this.size()).fill(0).map(((s,n)=>{return r=e[n],h=i[n],`${r.ref()}<${h.ref()} ? ${r.derivRef(t)} : ${h.derivRef(t)}`;var r,h})).join(",");return`vec${this.size()}(${s})`}}e.VecMin=d;class a extends n.WithVecDependencies{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),s=Array(this.size()).fill(0).map(((s,n)=>{return r=e[n],h=i[n],`${r.ref()}>${h.ref()} ? ${r.derivRef(t)} : ${h.derivRef(t)}`;var r,h})).join(",");return`vec${this.size()}(${s})`}}e.VecMax=a;class u extends n.WithVecDependencies{size(){return this.vecDependsOn[1].size()}definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${s.derivRef(t)}`}}e.VecIfElse=u;class o extends n.ScalarWithVecDependencies{definition(){return`dot(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn;return"xyzw".split("").slice(0,this.size()).map((s=>`${e.ref()}.${s}*${i.derivRef(t)}.${s}+${i.ref()}.${s}*${e.derivRef(t)}.${s}`)).join("+")}}e.Dot=o;class p extends n.ScalarWithVecDependencies{scalar(){return!0}definition(){return`length(${this.dependsOn[0].ref()})`}derivative(t){return`0.5/length(${this.dependsOn[0].ref()})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*${this.dependsOn[0].ref()}.${e}*${this.dependsOn[0].derivRef(t)}.${e}`)).join("+")}`}}e.Length=p;class c extends n.ScalarWithVecDependencies{definition(){return`distance(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`0.5/distance(${this.dependsOn.map((t=>t.ref())).join(",")})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*(${this.dependsOn.map((t=>t.ref())).join("-")}).${e}*(${this.dependsOn.map((e=>e.derivRef(t))).join("-")}).${e}`)).join("+")}`}}e.Dist=c,n.VectorOp.prototype.mix=s.UserInput((function(t,e){return new r(this.ad,this,t,this.ad.convertVal(e))})),n.VectorOp.prototype.clamp=s.UserInput((function(t,e){return new h(this.ad,this,t,e)})),n.VectorOp.prototype.min=s.UserInput((function(...t){return t.reduce(((t,e)=>new d(this.ad,t,e)),this)})),n.VectorOp.prototype.max=s.UserInput((function(...t){return t.reduce(((t,e)=>new a(this.ad,t,e)),this)})),n.VectorOp.prototype.dot=s.UserInput((function(t){return new o(this.ad,this,t)})),n.VectorOp.prototype.length=s.UserInput((function(){return new p(this.ad,this)})),n.VectorOp.prototype.dist=s.UserInput((function(t){return new c(this.ad,this,t)})),s.Op.prototype.vecIfElse=s.UserInput((function(t,e){return new u(this.ad,this,t,e)})),e.WithVecFunctions=function(t){return class extends t{constructor(){super(...arguments),this.vecMix=s.UserInput((function(t,e,i){return t.mix(e,i)})),this.vecClamp=s.UserInput((function(t,e,i){return t.clamp(e,i)})),this.vecMin=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMin()!");return t.reduce(((t,e)=>t.min(e)))})),this.vecMax=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMax()!");return t.reduce(((t,e)=>t.max(e)))})),this.dot=s.UserInput((function(t,e){return t.dot(e)})),this.length=s.UserInput((function(t){return t.length()})),this.dist=s.UserInput((function(t,e){return t.dist(e)}))}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}var s={};return(()=>{var t=s;Object.defineProperty(t,"__esModule",{value:!0}),t.gen=void 0;const e=i(433),n=i(888),r=i(225),h=i(789),d=i(165),a=i(35).WithVecFunctions(d.WithVecArithmetic(h.WithVecBase(r.WithFunctions(n.WithArithmetic(class{constructor(){this.nextID=0,this.settings={maxDepthPerVariable:8,debug:!1},this.params={},this.outputs={},this.derivOutputs={},this.val=e.UserInput((function(t){return new e.Value(this,t)})),this.param=e.UserInput((function(t){return new e.Param(this,t)}))}getNextID(){const t=this.nextID;return this.nextID++,t}registerParam(t,e){this.params[e]=t}convertVal(t){return t instanceof e.Op?t:this.val(t)}convertVals(t){return t.map((t=>this.convertVal(t)))}output(t,e){return this.outputs[t]=e,this}outputDeriv(t,e,i){const s="string"==typeof e?e:e.name;return this.derivOutputs[s]=this.derivOutputs[s]||{},this.derivOutputs[s][t]=i,this}gen(){let t="";const e=new Set;for(const t in this.outputs){for(const i of this.outputs[t].deepDependencies().values())e.add(i);e.add(this.outputs[t])}for(const t in this.derivOutputs)for(const i in this.derivOutputs[t]){for(const s of this.derivOutputs[t][i].deepDependencies().values())e.add(s);e.add(this.derivOutputs[t][i])}for(const i of e.values())t+=i.initializer();for(const e in this.outputs)t+=`${this.outputs[e].glslType()} ${e}=${this.outputs[e].ref()};\n`;for(const e in this.derivOutputs){const i=this.params[e],s=new Set;for(const t in this.derivOutputs[e]){for(const i of this.derivOutputs[e][t].deepDependencies().values())s.add(i);s.add(this.derivOutputs[e][t])}for(const e of s.values())t+=e.derivInitializer(i);for(const s in this.derivOutputs[e])t+=`${this.derivOutputs[e][s].glslType()} ${s}=${this.derivOutputs[e][s].derivRef(i)};\n`}return t}})))));t.gen=(t,e={})=>{const i=new a;for(const t in e)i.settings[t]=e[t];return t(i),i.gen()}})(),s})()}));